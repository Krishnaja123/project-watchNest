<!-- views/editCustomer.ejs -->
<%- include("../partials/admin/header") %>

    <head>
        <link rel="stylesheet" href="/css/admin/admin.css">
    </head>

<body>
  <div class="container">
    <!-- Sidebar -->
    <%- include("../partials/admin/sidebar") %>

      <!-- Main Content -->
      <div class="main">
        <h1>Edit User</h1>

        <div class="form-container">
          <div class="form-header">
            <h2>Edit User Information</h2>
          </div>

          <div class="user-details">
            <p><strong>UserId:</strong>
              <%= user._id %>
            </p>
            <p><strong>Username:</strong>
              <%= user.username %>
            </p>
            <p><strong>Email:</strong>
              <%= user.email %>
            </p>
            <p><strong>Phone Number:</strong>
              <%= user.phone_number %>
            </p>
            <p><strong>Role:</strong>
              <%= user.role %>
            </p>
            <p><strong>User Status:</strong>
              <%= user.userStatus %>
            </p>
            <p><strong>Created At:</strong>
              <%= user.created_at %>
            </p>
            <p><strong>Updated At:</strong>
              <%= user.updated_at %>
            </p>
          </div>

          <form action="/admin/editUser/<%= user._id %>?page=<%= page %>" method="post" id="editUserForm">
            <div class="form-row">
              <div class="form-group">
                <label for="role">Role</label>
                <select id="role" name="role">
                  <option value="admin" <%=user.role==="admin" ? "selected" : "" %>>
                    Admin
                  </option>
                  <option value="customer" <%=user.role==="customer" ? "selected" : "" %>>
                    Customer
                  </option>
                </select>
              </div>

              <div class="form-group">
                <label for="status">Status</label>
                <select id="status" name="status">
                  <option value="Active" <%=user.userStatus==="Active" ? "selected" : "" %>>
                    Active
                  </option>
                  <option value="Blocked" <%=user.userStatus==="Blocked" ? "selected" : "" %>>
                    Blocked
                  </option>
                </select>
              </div>

              <input type="hidden" id="userId" value="<%= user._id %>" readonly>
            </div>

            <div class="button-group">
              <button type="button" class="btn btn-cancel" id="cancelBtn">Cancel</button>
              <button type="submit" class="btn btn-primary">Update User</button>
            </div>
          </form>
        </div>
      </div>
  </div>
      <%- include("../partials/admin/footer") %>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("editUserForm");
      const role = document.getElementById("role");
      const status = document.getElementById("status");
      const userData = <% - JSON.stringify(user) %>;

      console.log(userData);

      // Set initial values
      function setFormFromUserData() {
        role.value = userData.role;
        status.value = userData.userStatus;
      }

      setFormFromUserData();

      // Form submission
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        form.submit();
      });

      // Cancel button
      document.getElementById("cancelBtn").addEventListener("click", function (e) {
        e.preventDefault();
        Swal.fire({
          icon: 'warning',
          title: 'Cancelled',
          text: 'No changes were saved!',
          timer: 2000,
          showConfirmButton: false
        }).then(() => {
          window.location.href = "/admin/customer/?page=<%= page %>";
        });
      });
    });
  </script>
</body>

</html>